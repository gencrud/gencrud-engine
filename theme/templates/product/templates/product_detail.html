{% extends 'main.html' %}
{% load static %}
{% load thumbnail %}

{% block title %}{{ product.seo_title }}{% endblock %}
{% block description %}{{ product.seo_description }}{% endblock %}
{% block keywords %}{{ product.seo_keywords }}{% endblock %}

{% block additional_css %}{% endblock %}

{% block breadcrumbs %}
    {% include 'default/breadcrumbs.html' with obj=product tree=product.catalog.first.get_family %}
{% endblock %}

{% block main %}
<section class="container">
    <h1 class="m-5">{{ product.title }}</h1>
    <section class="row">
        <div class="col-lg-8">
            {% if product.get_main_image and product.get_main_image.image %}
            <div>
                <a href="{{ product.get_main_image.image|thumbnail_url:'large' }}"
                    data-fancybox="product" 
                    data-caption="<h6>{{ product.get_main_image.image_tile }}</h6><span>{{ product.get_main_image.image_description }}</span>">
                    <img src="{{ product.get_main_image.image|thumbnail_url:'big' }}"
                        title="{{ product.get_main_image.image_title }}"
                        alt="current product image"
                        class="w-100"
                    />
                </a>
            </div>
            {% endif %}
            {# --- line bestseller AND new product --- #}
            {% if product.is_new %}
                <div class="badge badge-success new">NEW</div>
            {% endif %}
            {% if product.is_bestseller %}
                <div class="badge badge-warning top">TOP</div>
            {% endif %}
            {# ----------------- #}
            {% if product.description %}
            <p id="description" class="lead p-2">{{ product.description|safe }}</p>
            {% endif %}
        </div>

        <aside class="col-lg-4">
            {% if product.get_images.exists %}
            <div class="sidebar-product" id="thumbs">
                {% for img in product.get_images %}
                    {% if img.image %}
                    <div class="row sidebar-product-row">
                        <div class="col-6">
                            <a href="{{ img.image|thumbnail_url:'large' }}" 
                                data-fancybox="product" 
                                data-caption="<h6>{{ img.image_title }}</h6><span>{{ img.image_description }}</span>"
                                class="thumb">
                                <img src="{{ img.image|thumbnail_url:'medium' }}" alt="thumbnail" class="w-100">
                            </a>
                        </div>
                        {% if img.image_title or img.image_description %}
                        <div class="col-6 img-desc">
                            <p>{{ img.image_title }}</p>
                            <small class="text-muted">{{ img.image_description }}</small>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
            <hr />
            {% endif %}

            {% include 'product/templates/product_items.html' with main_obj=product objects=product.productitem_set.all %}

            {% comment %}
            <button class="btn btn-block btn-warning" data-toggle="modal" data-target="#product-claim-form-modal" data-product-pk="{{ product.pk }}">
                <i class="fa fa-bullhorn"></i> Заявка</button>
            <button class="btn btn-block btn-primary" {% if not request.user.is_authenticated %}disabled{% endif %} data-target="#cart-form" data-product-pk="{{ product.pk }}">
                <i class="fa fa-shopping-cart"></i> Корзина</button>
            {% endcomment %}

            {% include 'cart/templates/warning_authenticate.html' with className='small' %}

            {# ---  run JS % include 'order/templates/product_form.html' with type="modal" title="Заявка на проект" % --- #}
            {# % include 'product/templates/productl_form_add_cart.html' % #}
            <br />

        </aside>
    </section>

    {% if product.html %}
    <section class="mt-5 mb-5" id="details">
        <ul class="nav nav-tabs" id="tabListDescription" role="tablist">
            {% if product.html %}
             <li class="nav-item">
                 <a class="nav-link active" id="profile-tab" href="#html"
                    data-toggle="tab" role="tab"
                    aria-controls="html"
                    aria-selected="false">Подробное описание</a>
             </li>
            {% endif %}
            {% if product.get_product_params %}
             <li class="nav-item">
                 <a class="nav-link" id="profile-params" href="#params"
                    data-toggle="tab" role="tab"
                    aria-controls="html"
                    aria-selected="false">Параметры</a>
             </li>
            {% endif %}
        </ul>
        <div class="tab-content p-3" id="tabContent">
            <div class="tab-pane fade show active" id="html" role="tabpanel" aria-labelledby="html-tab">
            {% if product.html %}
                <div class="content">{{ product.html|safe }}</div>
            {% endif %}
            </div>
            {% if product.get_product_params %}
            <div class="tab-pane fade" id="params" role="tabpanel" aria-labelledby="params-tab">
                <div class="col">
                    <ul class="list-group list-group-flush">
                    {% for p in product.get_product_params %}
                        <li class="list-group-item">
                            {{ p.param.title }}: <b>{{ p.value }}</b>
                        </li>
                    {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </section>
    {% endif %}
    <section class="mt-5 mb-5">{% include 'default/next_prev.html' %}</section>
    {% include 'product/templates/item_bestseller_product.html' with objects=product.recommend_products.all title='Похожие товары' %}
</section>

{% if product.is_allow_comments %}<section class="container mt-5 mb-5">{% include 'default/form_comment.html' %}</section>{% endif %}
{% if comments %}<section class="container mt-5 mb-5">{% include 'default/comment_list.html' %}</section>{% endif %}

{% endblock %}


{% block additional_js %}
    <script type="text/javascript">
    $(document).ready(function(){
        $('[data-toggle="popover"]').popover();
        $('[data-fancybox="product"]').fancybox();
    });
    </script>
{% endblock %}